<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Playlists - Create New (Scoped)</title>
  <style>
    /* (kept your CSS exactly, only selectors remain the same) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      color: white; min-height: 100vh; padding: 20px;
    }

    .playlistSection .main-container { max-width: 1200px; margin: 0 auto; padding: 40px 0; }
    .playlistSection .header { display:flex; align-items:center; gap:20px; margin-bottom:30px; }
    .playlistSection .logo { width:80px; height:80px; background: linear-gradient(135deg,#8b5cf6,#a855f7); border-radius:20px; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(139,92,246,0.3); }
    .playlistSection .star-icon { width:40px; height:40px; fill:white; }
    .playlistSection .header-content h1 { font-size:48px; font-weight:800; margin-bottom:10px; }
    .playlistSection .header-content p { font-size:18px; color:#a1a1aa; font-weight:400; }
    .playlistSection .playlist-word { background: linear-gradient(135deg,#a855f7,#c084fc); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .playlistSection .create-btn { background: linear-gradient(135deg,#8b5cf6,#a855f7); color:white; padding:16px 30px; border:none; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; transition:all 0.3s ease; box-shadow:0 4px 20px rgba(139,92,246,0.3); display:flex; align-items:center; gap:10px; margin-top:20px; }
    .playlistSection .create-btn:hover { transform:translateY(-2px); box-shadow:0 8px 35px rgba(139,92,246,0.4); }

    .playlistSection .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); display:flex; align-items:center; justify-content:center; z-index:1000; opacity:0; visibility:hidden; transition:all 0.3s ease; }
    .playlistSection .overlay.active { opacity:1; visibility:visible; }
    .playlistSection .popup { background: linear-gradient(135deg,#1e1b4b,#312e81); border-radius:24px; width:100%; max-width:600px; max-height:90vh; overflow-y:auto; box-shadow:0 25px 80px rgba(0,0,0,0.5); transform:scale(0.8) translateY(30px); transition:all 0.3s ease; border:1px solid rgba(139,92,246,0.2); }
    .playlistSection .overlay.active .popup { transform:scale(1) translateY(0); }
    .playlistSection .popup-header { padding:30px 30px 0; display:flex; align-items:center; justify-content:space-between; margin-bottom:30px; }
    .playlistSection .popup-title { font-size:28px; font-weight:700; background: linear-gradient(135deg,#a855f7,#c084fc); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .playlistSection .close-btn { background: rgba(255,255,255,0.1); border:none; width:40px; height:40px; border-radius:50%; color:white; font-size:20px; cursor:pointer; transition:all 0.2s ease; display:flex; align-items:center; justify-content:center; }
    .playlistSection .close-btn:hover { background: rgba(255,255,255,0.2); }
    .playlistSection .popup-content { padding: 0 30px 30px; }
    .playlistSection .form-section { margin-bottom:25px; }
    .playlistSection .form-group { margin-bottom:20px; }
    .playlistSection .form-label { display:block; font-size:14px; font-weight:600; color:#e4e4e7; margin-bottom:8px; }
    .playlistSection .form-input { width:100%; padding:14px 16px; background: rgba(255,255,255,0.05); border:2px solid rgba(139,92,246,0.2); border-radius:12px; color:white; font-size:16px; transition:all 0.2s ease; }
    .playlistSection .form-input:focus { outline:none; border-color:#a855f7; background: rgba(255,255,255,0.1); box-shadow:0 0 0 4px rgba(168,85,247,0.1); }
    .playlistSection .form-input::placeholder { color:#a1a1aa; }
    .playlistSection .form-textarea { min-height:100px; resize:vertical; }
    .playlistSection .cover-upload-section { text-align:center; padding:20px; border:2px dashed rgba(139,92,246,0.3); border-radius:16px; background: rgba(255,255,255,0.02); transition:all 0.3s ease; cursor:pointer; }
    .playlistSection .cover-upload-section:hover { border-color: rgba(139,92,246,0.6); background: rgba(255,255,255,0.05); }
    .playlistSection .cover-preview { width:120px; height:120px; border-radius:16px; margin:0 auto 15px; object-fit:cover; border:3px solid rgba(139,92,246,0.3); }
    .playlistSection .upload-placeholder { width:120px; height:120px; background: rgba(139,92,246,0.1); border-radius:16px; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:48px; color:#a855f7; }
    .playlistSection .privacy-options { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .playlistSection .privacy-option { padding:16px; border:2px solid rgba(139,92,246,0.2); border-radius:12px; cursor:pointer; transition:all 0.2s ease; text-align:center; background: rgba(255,255,255,0.02); }
    .playlistSection .privacy-option:hover { border-color: rgba(139,92,246,0.4); }
    .playlistSection .privacy-option.selected { border-color: #a855f7; background: rgba(168,85,247,0.1); }
    .playlistSection .privacy-icon { font-size:24px; margin-bottom:8px; }
    .playlistSection .suggested-songs { margin-top:25px; }
    .playlistSection .songs-grid { display:grid; gap:12px; max-height:200px; overflow-y:auto; border-radius:12px; padding:5px; }
    .playlistSection .song-item { display:flex; align-items:center; gap:12px; padding:12px; background: rgba(255,255,255,0.05); border-radius:10px; cursor:pointer; transition:all 0.2s ease; border:1px solid transparent; }
    .playlistSection .song-item:hover { background: rgba(255,255,255,0.1); border-color: rgba(139,92,246,0.3); }
    .playlistSection .song-item.selected { background: rgba(168,85,247,0.2); border-color: #a855f7; }
    .playlistSection .song-cover { width:48px; height:48px; border-radius:8px; object-fit:cover; }
    .playlistSection .song-info h4 { font-size:14px; font-weight:600; margin-bottom:4px; }
    .playlistSection .song-info p { font-size:12px; color:#a1a1aa; }
    .playlistSection .form-actions { display:flex; gap:12px; margin-top:30px; padding-top:20px; border-top:1px solid rgba(139,92,246,0.2); }
    .playlistSection .btn-secondary { flex:1; padding:14px; background: rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); border-radius:12px; font-weight:600; cursor:pointer; transition:all 0.2s ease; }
    .playlistSection .btn-secondary:hover { background: rgba(255,255,255,0.15); }
    .playlistSection .btn-primary { flex:2; padding:14px; background: linear-gradient(135deg,#8b5cf6,#a855f7); color:white; border:none; border-radius:12px; font-weight:600; cursor:pointer; transition:all 0.2s ease; box-shadow:0 4px 20px rgba(139,92,246,0.3); }
    .playlistSection .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 25px rgba(139,92,246,0.4); }
    .playlistSection .btn-primary:disabled { opacity:0.6; cursor:not-allowed; transform:none; }
    .playlistSection .selected-count { background: linear-gradient(135deg,#8b5cf6,#a855f7); color:white; padding:4px 10px; border-radius:20px; font-size:12px; font-weight:600; margin-left:10px; }
    .playlistSection .songs-grid::-webkit-scrollbar { width:6px; }
    .playlistSection .songs-grid::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius:3px; }
    .playlistSection .songs-grid::-webkit-scrollbar-thumb { background: rgba(139,92,246,0.6); border-radius:3px; }
  </style>
</head>
<body>
  <section class="playlistSection">
    <div class="main-container">
      <div class="header">
        <div class="logo">
          <svg class="star-icon" viewBox="0 0 24 24">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
        <div class="header-content">
          <h1>My <span class="playlist-word">Playlists</span></h1>
          <p>Organize your favorite tracks into custom playlists</p>
        </div>
      </div>

      <!-- removed inline onclick; now handled in scoped JS -->
      <button type="button" class="create-btn">
        <span>+</span> Create New Playlist
      </button>
    </div>

    <!-- overlay does not use inline onclick anymore -->
    <div class="overlay" aria-hidden="true">
      <div class="popup" role="dialog">
        <div class="popup-header">
          <h2 class="popup-title">Create New Playlist</h2>
          <!-- removed inline onclick -->
          <button type="button" class="close-btn" aria-label="Close">&times;</button>
        </div>

        <div class="popup-content">
          <!-- changed id -> class (playlistForm) -->
          <form class="playlistForm" novalidate>
            <div class="form-section">
              <div class="form-group">
                <label class="form-label">Playlist Name *</label>
                <input type="text" class="form-input" placeholder="My Awesome Playlist" required>
              </div>

              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-input form-textarea" placeholder="Tell us about your playlist..."></textarea>
              </div>
            </div>

            <div class="form-section">
              <label class="form-label">Cover Image</label>
              <div class="cover-upload-section" role="button" tabindex="0">
                <!-- removed id and will update preview via JS -->
                <div class="upload-placeholder cover-preview-placeholder">🎵</div>
                <p>Click to upload cover image</p>
                <small style="color:#a1a1aa;">JPG, PNG up to 10MB</small>
              </div>
              <!-- changed id -> class (coverUpload) -->
              <input type="file" class="coverUpload" accept="image/*" style="display:none;">
            </div>

            <div class="form-section">
              <label class="form-label">Privacy Settings</label>
              <div class="privacy-options">
                <!-- added data-privacy so JS can detect -->
                <div class="privacy-option selected" data-privacy="public">
                  <div class="privacy-icon">🌍</div>
                  <div><strong>Public</strong></div>
                  <small>Anyone can find and play</small>
                </div>
                <div class="privacy-option" data-privacy="private">
                  <div class="privacy-icon">🔒</div>
                  <div><strong>Private</strong></div>
                  <small>Only you can access</small>
                </div>
              </div>
            </div>

            <div class="form-section">
              <label class="form-label">
                Add Songs to Playlist
                <!-- changed id -> class (selected-count) -->
                <span class="selected-count" style="display:none;">0 selected</span>
              </label>
              <div class="songs-grid">
                <!-- removed inline onclick from each .song-item -->
                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&h=100&fit=crop" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Blinding Lights</h4>
                    <p>The Weeknd</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=100&h=100&fit=crop" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Watermelon Sugar</h4>
                    <p>Harry Styles</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&h=100&fit=crop&sat=-100" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Good 4 U</h4>
                    <p>Olivia Rodrigo</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&h=100&fit=crop&hue=240" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Levitating</h4>
                    <p>Dua Lipa</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=100&h=100&fit=crop" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Stay</h4>
                    <p>The Kid LAROI & Justin Bieber</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&h=100&fit=crop&hue=120" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Industry Baby</h4>
                    <p>Lil Nas X & Jack Harlow</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=100&h=100&fit=crop" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Heat Waves</h4>
                    <p>Glass Animals</p>
                  </div>
                </div>

                <div class="song-item">
                  <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100&h=100&fit=crop&hue=60" alt="Album Cover" class="song-cover">
                  <div class="song-info">
                    <h4>Bad Habits</h4>
                    <p>Ed Sheeran</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn-secondary">Cancel</button>
              <button type="submit" class="btn-primary">Create Playlist</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script>
    (function() {
      // scope to the playlist section so no globals are created
      const section = document.querySelector('.playlistSection');
      if (!section) return;

      const overlay = section.querySelector('.overlay');
      const openBtn = section.querySelector('.create-btn');
      const closeBtn = section.querySelector('.close-btn');
      const form = section.querySelector('form.playlistForm');
      const coverUpload = section.querySelector('input.coverUpload');
      const coverUploadSection = section.querySelector('.cover-upload-section');
      const coverPreviewDiv = section.querySelector('.cover-preview-placeholder') || section.querySelector('.upload-placeholder');
      const selectedCountEl = section.querySelector('.selected-count');
      const privacyOptions = section.querySelectorAll('.privacy-option');
      const songItems = section.querySelectorAll('.song-item');
      const submitBtn = form.querySelector('.btn-primary');
      const cancelBtn = form.querySelector('.btn-secondary');

      // local-scoped state (won't pollute global scope)
      let ps_selectedPrivacy = 'public';
      let ps_selectedSongs = new Set();

      // Open popup
      openBtn.addEventListener('click', () => {
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      // Close popup when clicking overlay (outside the popup)
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closePopup();
      });

      // Close button
      closeBtn.addEventListener('click', closePopup);

      // Cancel action (reset & close)
      cancelBtn.addEventListener('click', () => {
        form.reset();
        coverPreviewDiv.innerHTML = '🎵';
        privacyOptions.forEach((opt) => opt.classList.toggle('selected', opt.dataset.privacy === 'public'));
        songItems.forEach(i => i.classList.remove('selected'));
        ps_selectedSongs.clear();
        updateSelectedCount();
        ps_selectedPrivacy = 'public';
        closePopup();
      });

      // Escape key closes popup when active
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && overlay.classList.contains('active')) closePopup();
      });

      function closePopup() {
        overlay.classList.remove('active');
        document.body.style.overflow = '';
      }

      // Cover upload triggers
      coverUploadSection.addEventListener('click', () => coverUpload.click());
      coverUpload.addEventListener('change', function() {
        const file = this.files && this.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
          coverPreviewDiv.innerHTML = `<img src="${evt.target.result}" alt="Cover Preview" class="cover-preview">`;
        };
        reader.readAsDataURL(file);
      });

      // Privacy options (use data-privacy attribute set in HTML)
      privacyOptions.forEach(option => {
        option.addEventListener('click', () => {
          privacyOptions.forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          ps_selectedPrivacy = option.dataset.privacy || 'public';
        });
      });

      // Song toggles
      songItems.forEach(item => {
        item.addEventListener('click', () => {
          const titleEl = item.querySelector('h4');
          const title = titleEl ? titleEl.textContent.trim() : null;
          if (!title) return;

          if (item.classList.contains('selected')) {
            item.classList.remove('selected');
            ps_selectedSongs.delete(title);
          } else {
            item.classList.add('selected');
            ps_selectedSongs.add(title);
          }
          updateSelectedCount();
        });
      });

      function updateSelectedCount() {
        const count = ps_selectedSongs.size;
        if (!selectedCountEl) return;
        if (count > 0) {
          selectedCountEl.textContent = `${count} selected`;
          selectedCountEl.style.display = 'inline-block';
        } else {
          selectedCountEl.style.display = 'none';
        }
      }

      // Form submission (scoped)
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const playlistTitle = form.querySelector('input[type="text"]').value || '';
        if (!playlistTitle.trim()) {
          alert('Please enter a playlist name');
          return;
        }

        submitBtn.textContent = 'Creating...';
        submitBtn.disabled = true;

        // simulate async save
        setTimeout(() => {
          alert(`Playlist "${playlistTitle}" created!\nPrivacy: ${ps_selectedPrivacy}\nSongs added: ${ps_selectedSongs.size}`);

          // Reset UI
          form.reset();
          coverPreviewDiv.innerHTML = '🎵';
          privacyOptions.forEach(opt => opt.classList.toggle('selected', opt.dataset.privacy === 'public'));
          songItems.forEach(item => item.classList.remove('selected'));
          ps_selectedSongs.clear();
          updateSelectedCount();
          ps_selectedPrivacy = 'public';

          submitBtn.textContent = 'Create Playlist';
          submitBtn.disabled = false;
          closePopup();
        }, 900);
      });
    })();
  </script>
</body>
</html>
